# 1.3 네트워크 코어

종단 시스템을 연결하는 패킷 스위치와 링크의 그물망
</br>
</br>

## 1.3.1 패킷 교환

- `패킷` : 출발지 종단 시스템에서 목적지 종단 시스템으로 보내기 위해 메시지를 작은 데이터 덩어리로 분할한 것
    - 패킷 스위치(라우터)와 링크 계층 스위치(link-layer switch)를 거침
    - 링크의 최대 전송률과 같은 속도로 각각의 통신 링크에서 전송된다

    - 패킷 전송 시간 = 패킷의 길이(L)/송신 속도(R)
        - R비트/초의 속도로 링크에서 L비트의 패킷을 송신한다면 그 패킷을 전송하는 데 걸리는 시간은 L/R초다.

### 저장-후-전달

- 대부분의 패킷 스위치가 이용하는 방식
- 스위치가 출력 링크로 `패킷의 첫 비트`를 전송하기 전에 전체 패킷을 받아야 함
- 라우터는 보통 여러 개의 링크를 갖는다.
    - 입력되는 패킷을 출력 링크로 교환함

![image](https://github.com/user-attachments/assets/0403b233-ef75-4b18-80d3-555d5164eb3b)
- 그림에서 라우터는 입력링크에서 다른 접속 링크로 패킷을 전달하는 간단한 기능을 가짐
  - 라우터는 받은 패킷의 비트를 buffer(store)한 후 패킷의 모든 비트를 수신한 후에 출력 링크로 패킷을 transmit(forward)하기 시작

- 전파 지연 무시한 전송 시간 계산
  - 0초: 출발지에서 전체 패킷 전송 시작
  - L/R초: 출발지에서 보낸 전체 패킷이 모두 라우터에 도착, 라우터에서 목적지를 향해 패킷을 출력 링크로 전송 시작
  - 2L/R초: 라우터에서 보낸 전체 패킷이 모두 목적지 수신 시스템에에 도착
  - 전체 지연은 2L/R
  - 만약 라우터(스위치)에서 비트가 지연되지 않는다면 L/R이 되지만 라우터는 전달하기에 앞서 전체 패킷을 수신, 저장, 처리할 필요가 있다 (->1.4절)

- 목적지 노드가 3개의 모든 패킷을 수신할때까지 경과되는 시간
    - 한 번 전송할 때 L/R걸리므로 4L/R
<img src="https://github.com/user-attachments/assets/9fe50551-842b-4d38-92bf-703168d47b8f" width="500"/>


 
 
- 출발지로부터 목적지 노드까지 N개의 링크로 구성되고 각각 전송률이 R인 경로를 통해 하나의 패킷을 전송하는 경우 (N-1개의 라우터)
     - 종단 간 지연 ![image](https://github.com/user-attachments/assets/5568633a-617e-4dd5-a87a-e094c1228ab4)


</br>
</br>

### 큐잉 지연과 패킷 손실

- 출력 버퍼
    - 패킷 스위치는 여러개의 링크를 가지고 각 링크에 대해 출력 버퍼(출력 큐)를 가지고 있음

- `큐잉 지연`(queuing dalay)
    - 한 패킷이 도착했을 때 링크가 다른 패킷을 전송하고 있다면 도착한 패킷이 출력 버퍼에서 대기하는 것
    - 네트워크의 혼잡 정도에 따른다.
    - `패킷 손실(packet loss)`: 버퍼가 꽉 차서 도착하는 패킷이나 이미 큐에 대기중인 패킷을 폐기(drop)하는 것

</br>

![image](https://github.com/user-attachments/assets/722ea713-3acb-4aea-bf0e-61c68093c866)

- 이 그림에서 모든 패킷은 같은 너비(비트수)와 길이를 갖는다
    - 짧은 기간 동안에 라우터에 도착하는 패킷의 전송률이 1.5Mbps를 초과하면 라우터에서 혼잡이 발생하게 되고 링크로 전송되기 전에 링크의 출력 버퍼에 큐잉된다.
    - 호스트 a,b가 동시에 연속해서 5개의 패킷을 송신하면 이들 패킷의 대부분은 큐에서 대기하는 데 시간을 보낼 것이다.

(-> 1.4절)

</br>

### 포워딩 테이블, 라우팅 프로토콜

- 라우팅: 패킷 전달하는 법. 갈림길마다 서서 방향을 물어보고 가는 것

- `IP 주소`: 모든 종단 시스템이 가짐, 계층적 구조를 가짐
    - 발송하는 패킷의 헤더에 목적지의 IP주소를 넣음
    
- `포워딩 테이블`: 목적지 주소 혹은 주소의 일부를 라우터의 출력 링크로 매핑함
    - 패킷이 라우터에 도착하면 라우터는 올바른 출력링크를 찾기 위해 주소를 조사하고 목적지 주소를 이용해 포워딩테이블을 검색한다. 그 후 출력 링크로 전송
    - 포워딩 테이블이 어떻게 설정되는가 등 ->5장

- 인터넷은 여러 특별한 `라우팅 프로토콜`을 가진다.: 자동으로 포워딩 테이블을 설정하는 프로토콜

</br>
</br>


## 1.3.2 회선 교환

- 데이터를 이동시키는 두 가지 기본 방식
    - 회선 교환(circuit switching) 네트워크: 예약을 요구하는 식당
    - 패킷 교환(packet switching) 네트워크: 예약 필요 없는 식당

- `회선 교환 네트워크`
    - 종단 시스템 간에 통신을 제공하기 위해 경로상에 필요한 자원(버퍼, 링크 전송률)은 통신 세션 동안에 확보 또는 예약(reserve)된다.
    - 세션 메시지는 on-demand 방식으로 자원을 요청하여 사용하고 통신 링크에 대한 접속을 위해 기다릴(큐에서 대기) 수도 있다.
    - 예) 전통적인 전화망
    - `회선`: 송신자와 수신자 간의 경로에 있는 스위치들이 해당 연결 상태를 유지해야 하는 연결
    - 네트워크가 회선을 설정할 때 그 연결이 이루어지는 동안 네트워크 링크(각링크의전송용량의일부)에 일정한 전송률을 예약한다.
    - 보장된 일정 전송률로 데이터를 보낼 수 있다.
  
<img src="https://github.com/user-attachments/assets/8a01d525-4467-4ba8-a3b7-eb9c4c13f68c" width="400">

그림 1.13
- 이 네트워크는 4개의 회선을 가지므로 각 링크는 4개의 동시 연결을 지원할 수 있다.
- 호스트 a, 호스트 b가 통신하기 위한 절차 (예: pc와 워크스테이션)
    - 호스트는 스위치 중 하나에 직접 연결된다.
    - `종단 간 연결(end-to-end connection)`: 두 호스트가 통신하고 싶을 때 네트워크가 설정하는 것
    - 두 개의 링크 각각에 한 회선을 예약한다.
    - 예를 들어 첫 번째 링크의 두 번째 회선을 사용하고 두 번째 링크의 네 번째 회선을 사용한다.
    - 각 링크는 **4개의 회선**을 가지므로 종단 간 연결을 사용하는 각 링크에 대해 그 **연결은** 연결이 지속되는 동안 **링크 전체 전송 용량의 1/4을 얻음**
    - 예를 들어 이웃한 스위치 간에 각 링크가 1Mbps의 전송률을 갖는다면 각 종단 간 회선 교환 연결은 지정된 전송률의 1/4인 250kbps를 얻음

- **패킷 교환 네트워크**(예: 인터넷)를 사용해 통신하는 예
    - 공통점: 통신 링크를 통해 전송
    - 차이점: 링크 자원을 예약하지 않고 네트워크로 보내짐
    - 만약 링크 중 하나가 혼잡하다면 그 패킷은 전송 링크의 송신 쪽 버퍼에서 기다려야 하고 지연이 발생한다.
    - 일정 시간 내에 전달하는 것을 보장하지 않음

</br>

### 회선 교환 네트워크에서의 다중화

- 링크 내 한 회선 구현 방식 2가지: FDM, TDM
- (예를 들어 TDM으로 구현한 링크는 TDM 링크)


![image](https://github.com/user-attachments/assets/3b568700-2a54-453b-82c9-955aedfbadc9)


- 주파수 분할 다중화 (frequency-division multiplexing, FDM)
    - 링크를 통해 설정된 연결은
        - 그 링크의 주파수 대역을 고정 제공한다.
        - 그 링크의 주파수 스펙트럼을 공유한다.
    - `대역폭(bandwidth)`: 주파수 대역
        - FM라디오 방송도 주파수 스펙트럼을 공유하는 데에 FDM을 사용
    - ![image](https://github.com/user-attachments/assets/23293393-1bcd-4bf8-9304-b7371fd2d4a0)


- 시분할 다중화 (time-division multuflexing, TDM)
    -  시간을 일정 주기의 프레임으로 구분하고 각 프레임은 고정된 수의 시간 슬롯으로 나뉜다.
    -  연결 설정시, 네트워크는 모든 프레임에서 시간 슬롯 1개를 그 연결에 할당한다.
    -  TDM 회선의 전송률: `한 슬롯 안의 비트 수 * 프레임 전송률`
        - 예를 들어 링크가 초당 8,000 프레임을 전송하고 각 슬롯이 8비트로 구성된다면 회선의 전송률은 64kbps  
    -  👇시간 영역이 시간 프레임으로 분할되고 각 프레임은 4개의 시간 슬롯을 가진다.
    -  ![image](https://github.com/user-attachments/assets/96902f6c-1327-4c20-a865-ea46c0e49cdc)


- 회선 교환 계산 예시
    - **회선 교환 네트워크를 통해 호스트 A에서 호스트 B까지 640,000 bit의 파일을 보내는 데 걸리는 시간**
    - 조건
        - 네크워크의 모든 링크는 24개의 슬롯을 가진 TDM을 사용하고 전송률은 1.536Mbps
        - 호스트 A가 파일을 전송하기 전에 종단 간 회선을 설정하는 데 0.5초가 소요
    - 계산
        - 각 회선의 전송률은 1.536Mbps/24 = 64kbps
        - 전송하는 데 걸리는 시간 640,000/64kbps= 10s
        - 회선 설정 시간을 더하면 ∴10.5s
    - 전송(transmission) 시간은 링크 수와 무관 (실제 종단 간 지연에는 전파 지연도 퐘하는데 1.4절에서 함)


- 패킷 교환 옹호자들은 회선 교환의 경우에 할당된 회선이 **비활용 기간(slient period)**에는 놀게 되므로 낭비라고 주장했다.
    - 종단 간 회선을 설정하고 대역폭을 보존하는 것이 복잡하고 경로에 있는 스위치들 사이의 운영을 조절하는 복잡한 신호 소프트웨어가 필요하다고 지적한다.

참고: [데이터 통신 다중화 기법 (FDM, TDM)](https://modorigoon.me/archives/559)
</br>
</br>

### 패킷 교환 대 회선 교환


- 패킷 교환 반대: 예측할 수 없는 종단간의 지연(큐잉 지연에서 발생) 때문에 실시간 서비스에 적당하지 않아
- 패킷 교환 찬성
    - 1. 회선 교환보다 전송 용량의 공유에서 효율적
      2. 패킷 교환이 더 간단하고 효율적이며 회선 교환보다 구현 비용이 적음

- 패킷 교환이 효율적인 이유
    - 사용자가 1Mbps 링크를 공유한다고 가정하고 10%의 시간만 활동한다고 했을 때
        - 회선교환의 경우 항상 각각의 사용자에게 예약되어야 한다.
        - 따라서 그 회선 교환 링크는 동시에 10명만 지원할 수 있다.
        - 패킷교환인 경우 35명의 사용자가 있다면 11명 이상 동시에 활동할 확률은 is less than .0004  (연습문제p8)
        - (10명 이상이면 출력 큐가 커지고 통합 입력률이 1Mbps이하로 떨어진후 큐 길이가 줄어듦)
        - 그럴 확률은 매우 적으므로 패킷 교환은 거의 항상 회선교환과 대등한 지연 성능을 가지면서도 **거의 3배 이상의 사용자 수를 허용한다**
    - 10명의 사용자 중 하나가 1000비트 패킷을 1000개 생성하고 나머지는 안함
        - TDM 회선 교환(한 프레임에 10개 슬롯*1000비트)인 경우
            - 한 프레임 당 1개의 시간 슬롯만 사용할 수 있고 9개는 쉰다.
            - 10초
        - 패킷교환의 경우
            - 다중화가 요구되지 않고 1Mbps가 가득 찰 때까지 패킷을 계속 보낼 수 있다. 
            - 1초         
- 위 두 가지 방식에서는 패킷교환>>회선교환
- 링크 전송률을 공유하는 두 방식의 가장 큰 차이점은 회선 교환이 요구에 관계없이 미리 전송 링크의 사용을 할당하는 반면에 패킷 교환은 요구할때만 링크의 사용을 할당한다는 것이다
- 회선 교환 방식처럼 사용하지 않는 링크 시간에는 링크 사용을 할당할 필요는 없다.
- 추세는 패킷교환

  
## 1.3.3 네트워크의 네트워크 (network of network)

- 앞 내용
    - 종단 시스템이 접속 ISP를 통해 인터넷에 연결
    - 접속 ISP는 텔코 혹은 케이블 회사일 필요는 없다. 대신에 대학교 혹은 회사가 ISP가 될 수 있다.
    - 그러나 접속 ISP로 연결하는 것은 극히 일부분
    - 접속 ISP끼리 연결되어야 한다.

- 네트워크의 네트워크 진화
    - 성능보다는 경제적, 국가적 정책에 의해 주도
    - 가장 중요한 목표는 모든 종단 시스템이 서로에게 패킷을 보낼 수 있도록 접속ISP를 연결하는 것
    - 그물망 설계: 서로 직접 연결... 매우 간단하지만 너무 많은 비용을 발생시킨다

- 네트워크 구조 1
    - 모든 접속 ISP를 하나의 글로벌 통과(transit)ISP와 연결한다.
    - 
